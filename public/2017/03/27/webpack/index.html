<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <!-- PACE Progress Bar START -->
  
    <script src="/personal-blog/public/js/pace.min.js"></script>
    <link rel="stylesheet" href="https://github.com/HubSpot/pace/raw/master/themes/orange/pace-theme-flash.css">
  
  

  <!-- PACE Progress Bar START -->

  
  <title>webpack 入门指迷 | Qing的前端开发Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="Webpack" />
  
  
  
  
  <meta name="description" content="Webpack 是什么?Github：https://github.com/webpackWebpack 是德国开发者 Tobias Koppers 开发的模块加载器Instagram 工程师认为这个方案很棒, 似乎还把作者招过去了在 Webpack 当中, 所有的资源都被当作是模块, js, css, 图片等等..因此, Webpack 当中 js 可以引用 css, css 中可以嵌入图片 d">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack 入门指迷">
<meta property="og:url" content="https://walkstreet.github.io/personal-blog/public/2017/03/27/webpack/index.html">
<meta property="og:site_name" content="Qing的前端开发Blog">
<meta property="og:description" content="Webpack 是什么?Github：https://github.com/webpackWebpack 是德国开发者 Tobias Koppers 开发的模块加载器Instagram 工程师认为这个方案很棒, 似乎还把作者招过去了在 Webpack 当中, 所有的资源都被当作是模块, js, css, 图片等等..因此, Webpack 当中 js 可以引用 css, css 中可以嵌入图片 d">
<meta property="og:updated_time" content="2018-02-23T09:47:02.458Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Webpack 入门指迷">
<meta name="twitter:description" content="Webpack 是什么?Github：https://github.com/webpackWebpack 是德国开发者 Tobias Koppers 开发的模块加载器Instagram 工程师认为这个方案很棒, 似乎还把作者招过去了在 Webpack 当中, 所有的资源都被当作是模块, js, css, 图片等等..因此, Webpack 当中 js 可以引用 css, css 中可以嵌入图片 d">
  
    <link rel="alternate" href="/atom.xml" title="Qing的前端开发Blog" type="application/atom+xml">
  
  <link rel="icon" href="/personal-blog/public/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/personal-blog/public/css/style.css">

  <script src="/personal-blog/public/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/personal-blog/public/css/bootstrap.css" >
  <link rel="stylesheet" href="/personal-blog/public/css/hiero.css" >
  <link rel="stylesheet" href="/personal-blog/public/css/glyphs.css" >
  
    <link rel="stylesheet" href="/personal-blog/public/css/vdonate.css" >
  

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/personal-blog/public/css/my.css">
  <!-- Google Adsense -->
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
      (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-0123456789ABCDEF",
          enable_page_level_ads: true
      });
  </script>
</head>

<script>
var themeMenus = {};

  themeMenus["/personal-blog/public/"] = "首页"; 

  themeMenus["/personal-blog/public/archives"] = "归档"; 

  themeMenus["/personal-blog/public/categories"] = "分类"; 

  themeMenus["/personal-blog/public/tags"] = "标签"; 

  themeMenus["/personal-blog/public/about"] = "关于"; 

</script>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/personal-blog/public/" title="Qing的前端开发Blog" rel="home"> Qing的前端开发Blog </a>
            
          </h1>

          
            <div class="site-description">Web前端开发文档整理</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/personal-blog/public/">首页</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/personal-blog/public/archives">归档</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/personal-blog/public/categories">分类</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/personal-blog/public/tags">标签</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/personal-blog/public/about">关于</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div id="originBgDiv" style="background: #fff; width: 100%;">

      <div style="max-height:600px; overflow: hidden;  display: flex; display: -webkit-flex; align-items: center;">
        <img id="originBg" width="100%" alt="" src="">
      </div>

  </div>

  <script>
  function setAboutIMG(){
      var imgUrls = "css/images/pose.jpg,https://source.unsplash.com/collection/954550/1920x1080".split(",");
      var random = Math.floor((Math.random() * imgUrls.length ));
      if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
        document.getElementById("originBg").src=imgUrls[random];
      } else {
        document.getElementById("originBg").src='/personal-blog/public/' + imgUrls[random];
      }
  }
  bgDiv=document.getElementById("originBgDiv");
  if(location.pathname.match('about')){
    setAboutIMG();
    bgDiv.style.display='block';
  }else{
    bgDiv.style.display='none';
  }
  </script>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-webpack" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Webpack 入门指迷
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/personal-blog/public/2017/03/27/webpack/" class="article-date">
	  <time datetime="2017-03-27T06:46:16.000Z" itemprop="datePublished">三月 27, 2017</time>
	</a>

      
	<span id="busuanzi_container_page_pv">
	  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
	</span>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Webpack-是什么"><a href="#Webpack-是什么" class="headerlink" title="Webpack 是什么?"></a>Webpack 是什么?</h2><p>Github：<a href="https://github.com/webpack" target="_blank" rel="external">https://github.com/webpack</a><br>Webpack 是德国开发者 Tobias Koppers 开发的模块加载器<br>Instagram 工程师认为这个方案很棒, 似乎还把作者招过去了<br>在 Webpack 当中, 所有的资源都被当作是模块, js, css, 图片等等..<br>因此, Webpack 当中 js 可以引用 css, css 中可以嵌入图片 dataUrl  </p>
<a id="more"></a>
<p>对应各种不同文件类型的资源, Webpack 有对应的模块 loader<br>比如 CoffeeScript 用的是 <font class="font-danger">coffee-loader</font>, 其他还有很多:<br><a href="http://webpack.github.io/docs/list-of-loaders.html" target="_blank" rel="external">http://webpack.github.io/docs/list-of-loaders.html</a><br>大致的写法也就这样子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">module: &#123;</div><div class="line">    loaders: [</div><div class="line">        &#123; test: /\.coffee$/, loader: &apos;coffee-loader&apos; &#125;,</div><div class="line">        &#123; test: /\.js$/, loader: &apos;jsx-loader?harmony&apos; &#125; // loaders can take parameters as a querystring</div><div class="line">    ]</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<h2 id="CommonJS-与-AMD-支持"><a href="#CommonJS-与-AMD-支持" class="headerlink" title="CommonJS 与 AMD 支持"></a>CommonJS 与 AMD 支持</h2><p>Webpack 对 CommonJS 的 AMD 的语法做了兼容, 方便迁移代码 不过实际上, 引用模块的规则是依据 CommonJS 来的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">require(&apos;lodash&apos;) // 从模块目录查找</div><div class="line">require(&apos;./file&apos;) // 按相对路径查找</div></pre></td></tr></table></figure></p>
<p>AMD 语法中, 也要注意, 是按 CommonJS 的方案查找的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">define (require, exports. module) -&gt;</div><div class="line">    require(&apos;lodash&apos;) # commonjs 当中这样是查找模块的</div><div class="line">    require(&apos;./file&apos;)</div></pre></td></tr></table></figure></p>
<h2 id="特殊模块的-Shim"><a href="#特殊模块的-Shim" class="headerlink" title="特殊模块的 Shim"></a>特殊模块的 Shim</h2><p>比如某个模块依赖 <font class="font-danger">window.jQuery</font>, 需要从 npm 模块中将 <font class="font-danger">jquery</font> 挂载到全局<br>Webpack 有不少的 Shim 的模块, 比如 <font class="font-danger">expose-loader</font> 用于解决这个问题<br><a href="https://github.com/webpack/docs/wiki/shimming-modules" target="_blank" rel="external">https://github.com/webpack/docs/wiki/shimming-modules</a><br>其他比如从模块中导出变量…具体说明有点晦涩..</p>
<p>手头的两个例子, 比如我们用到 Pen 这个模块,<br>这个模块对依赖一个 <font class="font-danger">window.jQuery</font>, 可我手头的 jQuery 是 CommonJS 语法的<br>而 <font class="font-danger">Pen</font> 对象又是生成好了绑在全局的, 可是我又需要通过 <font class="font-danger">require(‘pen’)</font> 获取变量<br>最终的写法就是做 Shim 处理直接提供支持:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;test: require.resolve(&apos;jquery&apos;), loader: &apos;expose?jQuery&apos;&#125;,</div><div class="line">&#123;test: require.resolve(&apos;pen&apos;), loader: &apos;exports?window.Pen&apos;&#125;,</div></pre></td></tr></table></figure></p>
<h2 id="基本的使用"><a href="#基本的使用" class="headerlink" title="基本的使用"></a>基本的使用</h2><p>安装 <font class="font-danger">webpack</font> 模块之后, 可是使用 <font class="font-danger">webpack</font> 这个命令行工具<br>可以使用参数, 也可以配置 <font class="font-danger">webpack.config.js</font> 文件直接运行 <font class="font-danger">webpack</font> 调用<br>建议按照 Peter Hunt 给的教程走一遍, 基本的功能都会用到了<br><a href="https://github.com/petehunt/webpack-howto" target="_blank" rel="external">https://github.com/petehunt/webpack-howto</a></p>
<p>简单的例子就是这样一个文件, 可以把 <font class="font-danger">./main.js</font> 作为入口打包 <font class="font-danger">bundle.js</font>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// webpack.config.js</div><div class="line">module.exports = &#123;</div><div class="line">    entry: &apos;./main.js&apos;,</div><div class="line">    output: &#123;</div><div class="line">        filename: &apos;bundle.js&apos;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="查找依赖"><a href="#查找依赖" class="headerlink" title="查找依赖"></a>查找依赖</h2><p>Webpack 是类似 Browserify 那样在本地按目录对依赖进行查找的<br>可以构造一个例子, 用 <font class="font-danger">–display-error-details</font> 查看查找过程,<br>例子当中 <font class="font-danger">resolve.extensions</font> 用于指明程序自动补全识别哪些后缀,<br>注意一下, <font class="font-danger">extensions</font> 第一个是空字符串! 对应不需要后缀的情况.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// webpack.config.js</div><div class="line">module.exports = &#123;</div><div class="line">  entry: &apos;./a.js&apos;,</div><div class="line">  output: &#123;</div><div class="line">    filename: &apos;b.js&apos;</div><div class="line">  &#125;,</div><div class="line">  resolve: &#123;</div><div class="line">    extensions: [&apos;&apos;, &apos;.coffee&apos;, &apos;.js&apos;]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// a.js</div><div class="line">require(&apos;./c&apos;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">➤➤ webpack --display-error-details</div><div class="line">Hash: e38f7089c39a1cf34032</div><div class="line">Version: webpack 1.5.3</div><div class="line">Time: 54ms</div><div class="line">Asset  Size  Chunks             Chunk Names</div><div class="line"> b.js  1646       0  [emitted]  main</div><div class="line">   [0] ./a.js 15 &#123;0&#125; [built] [1 error]</div><div class="line"></div><div class="line">ERROR in ./a.js</div><div class="line">Module not found: Error: Cannot resolve &apos;file&apos; or &apos;directory&apos; ./c in /Users/chen/Drafts/webpack/details</div><div class="line">resolve file</div><div class="line">  /Users/chen/Drafts/webpack/details/c doesn&apos;t exist</div><div class="line">  /Users/chen/Drafts/webpack/details/c.coffee doesn&apos;t exist</div><div class="line">  /Users/chen/Drafts/webpack/details/c.js doesn&apos;t exist</div><div class="line">resolve directory</div><div class="line">  /Users/chen/Drafts/webpack/details/c doesn&apos;t exist (directory default file)</div><div class="line">  /Users/chen/Drafts/webpack/details/c/package.json doesn&apos;t exist (directory description file)</div><div class="line">[/Users/chen/Drafts/webpack/details/c]</div><div class="line">[/Users/chen/Drafts/webpack/details/c.coffee]</div><div class="line">[/Users/chen/Drafts/webpack/details/c.js]</div><div class="line"> @ ./a.js 2:0-14</div></pre></td></tr></table></figure>
<p><font class="font-danger">./c</font> 是不存在, 从这个错误信息当中我们大致能了解 Webpack 是怎样查找的<br>大概就是会尝试各种文件名, 会尝试作为模块, 等等<br>一般模块就是查找 <font class="font-danger">node_modules</font>, 但这个也是能被配置的:<br><a href="http://webpack.github.io/docs/configuration.html#resolve-modulesdirectories" target="_blank" rel="external">http://webpack.github.io/docs/configuration.html#resolve-modulesdirectories</a></p>
<h2 id="CSS-及图片的引用"><a href="#CSS-及图片的引用" class="headerlink" title="CSS 及图片的引用"></a>CSS 及图片的引用</h2><p>英文的教程上有明确的例子:<br><a href="https://github.com/petehunt/webpack-howto#5-stylesheets-and-images" target="_blank" rel="external">https://github.com/petehunt/webpack-howto#5-stylesheets-and-images</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">require(&apos;./bootstrap.css&apos;);</div><div class="line">require(&apos;./myapp.less&apos;);</div><div class="line"></div><div class="line">var img = document.createElement(&apos;img&apos;);</div><div class="line">img.src = require(&apos;./glyph.png&apos;);</div></pre></td></tr></table></figure></p>
<p>上边的是 JavaScript 代码, CSS 跟 LESS, 还有图片, 被直接引用了<br>实际上 CSS 被转化为 <font class="font-danger"> &lt; style ></font> 标签, 而图片可能被转化成 base64 格式的 dataUrl<br>但是要主要在 <font class="font-danger">webpack.config.js</font> 文件写好对应的 <font class="font-danger">loader</font>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// webpack.config.js</div><div class="line">module.exports = &#123;</div><div class="line">    entry: &apos;./main.js&apos;,</div><div class="line">    output: &#123;</div><div class="line">        path: &apos;./build&apos;, // This is where images AND js will go</div><div class="line">        publicPath: &apos;http://mycdn.com/&apos;, // This is used to generate URLs to e.g. images</div><div class="line">        filename: &apos;bundle.js&apos;</div><div class="line">    &#125;,</div><div class="line">    module: &#123;</div><div class="line">        loaders: [</div><div class="line">            &#123; test: /\.less$/, loader: &apos;style-loader!css-loader!less-loader&apos; &#125;, // use ! to chain loaders</div><div class="line">            &#123; test: /\.css$/, loader: &apos;style-loader!css-loader&apos; &#125;,</div><div class="line">            &#123;test: /\.(png|jpg)$/, loader: &apos;url-loader?limit=8192&apos;&#125; // inline base64 URLs for &lt;=8k images, direct URLs for the rest</div><div class="line">        ]</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="url-loader"><a href="#url-loader" class="headerlink" title="url-loader"></a>url-loader</h3><p>稍微啰嗦一下这个 loader, 这个 loader 实际上是对 <font class="font-danger">file-loader</font> 的封装<br><a href="https://github.com/webpack/url-loader" target="_blank" rel="external">https://github.com/webpack/url-loader</a><br>比如 CSS 文件当中有这样的引用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">.demo &#123;</div><div class="line">    background-image: url(&apos;a.png&apos;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>那么对应这样的 loader 配置就能把 <font class="font-danger">a.png</font> 抓出来,<br>并且按照文件大小, 或者转化为 base64, 或者单独作为文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">module: &#123;</div><div class="line">    loaders: [</div><div class="line">        &#123;test: /\.(png|jpg)$/, loader: &apos;url-loader?limit=8192&apos;&#125; // inline base64 URLs for &lt;=8k images, direct URLs for the rest</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上边 <font class="font-danger">?</font> 后边的 query 有两种写法, 可以看下文档:<br><a href="http://webpack.github.io/docs/using-loaders.html#query-parameters" target="_blank" rel="external">http://webpack.github.io/docs/using-loaders.html#query-parameters</a></p>
<ul>
<li>file-loader</li>
</ul>
<p>由于 url-loader 是对 <font class="font-danger">file-loader</font> 的一个封装, 以因此带有后者一些功能:<br><a href="https://github.com/webpack/file-loader" target="_blank" rel="external">https://github.com/webpack/file-loader</a><br>比如说, <font class="font-danger">file-loader</font> 有不弱的定义文件名的功能<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">require(&quot;file?name=[path][name].[ext]?[hash]!./dir/file.png&quot;)</div></pre></td></tr></table></figure></p>
<p>对应 <font class="font-danger">url-loader</font> 当中如果文件超出体积, 就给一个这样的文件名..</p>
<h2 id="打成多个包"><a href="#打成多个包" class="headerlink" title="打成多个包"></a>打成多个包</h2><p>有时考虑类库代码的缓存, 我们会考虑打成多个包, 这样不难<br>比如下边的配置, 首先 <font class="font-danger">entry</font> 有多个属性, 对应多个 JavaScript 包,<br>然后 <font class="font-danger">commonsPlugin</font> 可以用于分析模块的共用代码, 单独打一个包出来:<br><a href="https://github.com/petehunt/webpack-howto#8-optimizing-common-code" target="_blank" rel="external">https://github.com/petehunt/webpack-howto#8-optimizing-common-code</a><br><a href="https://github.com/webpack/docs/wiki/optimization#multi-page-app" target="_blank" rel="external">https://github.com/webpack/docs/wiki/optimization#multi-page-app</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// webpack.config.js</div><div class="line">var webpack = require(&apos;webpack&apos;);</div><div class="line">var commonsPlugin = new webpack.optimize.CommonsChunkPlugin(&apos;common.js&apos;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">    entry: &#123;</div><div class="line">        Profile: &apos;./profile.js&apos;,</div><div class="line">        Feed: &apos;./feed.js&apos;</div><div class="line">    &#125;,</div><div class="line">    output: &#123;</div><div class="line">        path: &apos;build&apos;,</div><div class="line">        filename: &apos;[name].js&apos; // Template based on keys in entry above</div><div class="line">    &#125;,</div><div class="line">    plugins: [commonsPlugin]</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="对文件做-revision"><a href="#对文件做-revision" class="headerlink" title="对文件做 revision"></a>对文件做 revision</h2><p>这个在文档上做了说明, 可以自动生成 js 文件的 Hash:<br><a href="http://webpack.github.io/docs/long-term-caching.html" target="_blank" rel="external">http://webpack.github.io/docs/long-term-caching.html</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">output: &#123; chunkFilename: &quot;[chunkhash].bundle.js&quot; &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">plugins: [</div><div class="line">    function() &#123;</div><div class="line">        this.plugin(&quot;done&quot;, function(stats) &#123;</div><div class="line">            require(&quot;fs&quot;).writeFileSync(</div><div class="line">                path.join(__dirname, &quot;...&quot;, &quot;stats.json&quot;),</div><div class="line">                JSON.stringify(stats.toJson()));</div><div class="line">            )</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>同时, 可以注册事件, 拿到生成的带 Hash 的文件的一个表<br>但是拿到那个表之后, 就需要自己写代码进行替换了.. 这有点麻烦<br>官网的 Issue 里提到个办法是生成 HTML 时引用 <font class="font-danger">stats.json</font> 的数据,<br>我此前的方案是生成 HTML 之后再进行替换, 相对赖上生成时写入更好一些</p>
<h2 id="上线"><a href="#上线" class="headerlink" title="上线"></a>上线</h2><ul>
<li>另一份配置文件</li>
</ul>
<p>用 <font class="font-danger">webpack –config webpack.min.js</font> 指定另一个名字的配置文件<br>这个文件当中可以写不一样配置, 专门用于代码上线时的操作</p>
<ul>
<li>压缩 JavaScript</li>
</ul>
<p>因为代码都是 JavaScript, 所以压缩就很简单了, 加上一行 plugin 就好了<br><a href="http://webpack.github.io/docs/list-of-plugins.html#uglifyjsplugin" target="_blank" rel="external">http://webpack.github.io/docs/list-of-plugins.html#uglifyjsplugin</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">plugins: [</div><div class="line">   new webpack.optimize.MinChunkSizePlugin(minSize)</div><div class="line">]</div></pre></td></tr></table></figure></p>
<ul>
<li>压缩 React</li>
</ul>
<p>React 官方提供的代码是已经合并的, 这个是 Webpack 不推荐的用法, 在合并话的代码上进行定制有点麻烦, Webpack 提供了设置环境变量来优化代码的方案:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">new webpack.DefinePlugin(&#123;</div><div class="line">  &quot;process.env&quot;: &#123;</div><div class="line">    NODE_ENV: JSON.stringify(&quot;production&quot;)</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p><a href="https://github.com/webpack/webpack/issues/292#issuecomment-44804366" target="_blank" rel="external">https://github.com/webpack/webpack/issues/292#issuecomment-44804366</a></p>
<ul>
<li>CDN</li>
</ul>
<p>替换 CDN 这个工作, Webpack 也内置了, 设置 output.publicPath 即可<br><a href="http://webpack.github.io/docs/configuration.html#output-publicpath" target="_blank" rel="external">http://webpack.github.io/docs/configuration.html#output-publicpath</a></p>
<h2 id="代码热替换"><a href="#代码热替换" class="headerlink" title="代码热替换"></a>代码热替换</h2><p>虽然文档上写得挺复杂的, 但如果只是简单的功能还是很容易的</p>
<ol>
<li>第一步, 把 ‘<font class="font-danger">webpack/hot/dev-server</font>‘ 加入到打包的代码当中,<br>这个是对应 node_modules/webpack/ 目录当中的文件的:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">entry: &#123;</div><div class="line">    main: [&apos;webpack/hot/dev-server&apos;, &apos;./main&apos;],</div><div class="line">    vendor: [&apos;lodash&apos;, &apos;./styles&apos;]</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<ol>
<li>启动服务器, 比如我是这样子的<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webpack-dev-server --hot --quiet</div></pre></td></tr></table></figure>
</li>
</ol>
<p>正常可以看到提示说服务器已经起来了<br><a href="http://localhost:8080/webpack-dev-server/" target="_blank" rel="external">http://localhost:8080/webpack-dev-server/</a><br>如果有 <font class="font-danger">index.html</font> 的话, 直接访问网址应该就能开始调试了</p>
<h2 id="React-Hot-Replace"><a href="#React-Hot-Replace" class="headerlink" title="React Hot Replace"></a>React Hot Replace</h2><p>调试 React 的话, 有这样的工具简直是神器了, 甚至不用刷新页面!<br><a href="http://gaearon.github.io/react-hot-loader/getstarted/" target="_blank" rel="external">http://gaearon.github.io/react-hot-loader/getstarted/</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">entry: [</div><div class="line">    &apos;webpack-dev-server/client?http://0.0.0.0:8080&apos;, // WebpackDevServer host and port</div><div class="line">    &apos;webpack/hot/only-dev-server&apos;,</div><div class="line">    &apos;./scripts/index&apos; // Your appʼs entry point</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>我特意问了下作者为什么上边配置看起来不一样..<br><a href="https://github.com/gaearon/react-hot-loader/issues/73#issuecomment-73679446" target="_blank" rel="external">https://github.com/gaearon/react-hot-loader/issues/73#issuecomment-73679446</a><br>回复大致说是为了避免自动的强制刷新他用了特别的写法..<br>关于这项功能具体如何实现, 我没有深入了解过…</p>
<h2 id="hot-replace-非静态的网页"><a href="#hot-replace-非静态的网页" class="headerlink" title="hot replace 非静态的网页"></a>hot replace 非静态的网页</h2><p>上边 <font class="font-danger">localhost:8080</font> 的方案并不适合复杂的页面,<br>于是文档上给出了一套稍微复杂一些的方案, 用来配合其他的服务器调试<br>大致的思路是这样的:</p>
<ol>
<li><p>Webpack 打包生成的那些静态资源用服务器 A 进行 serve<br>这里说的 A 就是上边说的这个:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webpack-dev-server --hot --quiet</div></pre></td></tr></table></figure>
</li>
<li><p>我们的 HTML 由 B 渲染, B 会引用 A serve 的静态资源<br>B 生成的页面当中加上类似这样的代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script src=&quot;http://&lt;A 的地址&gt;/assets/bundle.js&quot;&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>还可能要设置一下 output.publicPath, 把所有静态资源指向 A</p>
<ol>
<li>文件修改时, <font class="font-danger">webpack-dev-server</font> 通过 <font class="font-danger">socket.io</font> 通知客户端更新</li>
</ol>
<p>这个步骤在文档上写得有点难懂, 大概要多尝试几次才行, 我也弄错很多次<br><a href="http://webpack.github.io/docs/webpack-dev-server.html" target="_blank" rel="external">http://webpack.github.io/docs/webpack-dev-server.html</a></p>
<h2 id="单独打包-CSS"><a href="#单独打包-CSS" class="headerlink" title="单独打包 CSS"></a>单独打包 CSS</h2><p>因为公司里有这个需要求, 强制把 CSS 从 js 文件当中独立出来.<br>官方文档是以插件的形式做的:<br><a href="http://webpack.github.io/docs/stylesheets.html#separate-css-bundle" target="_blank" rel="external">http://webpack.github.io/docs/stylesheets.html#separate-css-bundle</a><br>参考文档但是注意一下函数参数, 第一第二个参数是有区别的, 比如这样用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExtractTextPlugin.extract(&apos;style-loader&apos;, &apos;css!less&apos;)</div></pre></td></tr></table></figure>
<p>第一个参数是编译好以后的代码用的, 第二个参数是编译到源代码用的.. 有点难懂..</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Webpack 的报错挺不友好的, 最初的时候我看着模块找不到没法搞明白 这种时候把中间过程打印出来看是不错的选择:</p>
<p>webpack –display-error-details<br>另一个报错是没有对应 loader 的提示.. log 可能很长找不到重点<br>我建议是先自己去想想什么地方需要考虑 loader 吧… 可能就知道了<br>我还遇到就是源码里有使用 dataUrl 导致报错… 确实奇怪了</p>
<p>不说这些坑的话, Webpack 我认为是我目前接触到最好的前端开发方案<br>很多功能之前 FIS 文档上看到过, 但 FIS 相对重一些我始终没上手<br>而 Webpack 一上来就绕过了此前公司用 RequireJS 打包时遇到的各种问题</p>
<p>如果去扫 Webpack 的文档的话, 还有很多功能我完全没涉及到..<br><a href="http://webpack.github.io/docs/" target="_blank" rel="external">http://webpack.github.io/docs/</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/personal-blog/public/categories/自动化构建/">自动化构建</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/personal-blog/public/tags/Webpack/">Webpack</a></li></ul>

      
        <div id="donation_div"></div>

<script src="/personal-blog/public/js/vdonate.js"></script>
<script>
var a = new Donate({
  title: '如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作!', // 可选参数，打赏标题
  btnText: '打赏支持', // 可选参数，打赏按钮文字
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/WeChanQR.png',
  alipayImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/AliPayQR.jpg'
});
</script>
      
            
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>


      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/personal-blog/public/2017/03/28/js-this/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          Javascript之this详解
        
      </div>
    </a>
  
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
      <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-是什么"><span class="nav-number">1.</span> <span class="nav-text">Webpack 是什么?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CommonJS-与-AMD-支持"><span class="nav-number">2.</span> <span class="nav-text">CommonJS 与 AMD 支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#特殊模块的-Shim"><span class="nav-number">3.</span> <span class="nav-text">特殊模块的 Shim</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本的使用"><span class="nav-number">4.</span> <span class="nav-text">基本的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找依赖"><span class="nav-number">5.</span> <span class="nav-text">查找依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSS-及图片的引用"><span class="nav-number">6.</span> <span class="nav-text">CSS 及图片的引用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#url-loader"><span class="nav-number">6.1.</span> <span class="nav-text">url-loader</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打成多个包"><span class="nav-number">7.</span> <span class="nav-text">打成多个包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对文件做-revision"><span class="nav-number">8.</span> <span class="nav-text">对文件做 revision</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#上线"><span class="nav-number">9.</span> <span class="nav-text">上线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码热替换"><span class="nav-number">10.</span> <span class="nav-text">代码热替换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-Hot-Replace"><span class="nav-number">11.</span> <span class="nav-text">React Hot Replace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hot-replace-非静态的网页"><span class="nav-number">12.</span> <span class="nav-text">hot replace 非静态的网页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单独打包-CSS"><span class="nav-number">13.</span> <span class="nav-text">单独打包 CSS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">14.</span> <span class="nav-text">总结</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2018 Qing的前端开发Blog All Rights Reserved.
          
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->
<script src="/personal-blog/public/js/my.js"></script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/personal-blog/public/" class="mobile-nav-link">Home</a>
  
    <a href="/personal-blog/public/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/personal-blog/public/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/personal-blog/public/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/personal-blog/public/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/personal-blog/public/fancybox/jquery.fancybox.css">
  <script src="/personal-blog/public/fancybox/jquery.fancybox.pack.js"></script>


<script src="/personal-blog/public/js/scripts.js"></script>
<script src="/personal-blog/public/js/bootstrap.js"></script>
<script src="/personal-blog/public/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
<style>
.donate-btn {
    display: none;
}
.originBgDiv {
    display: none;
}
</style>